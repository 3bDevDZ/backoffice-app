{% extends "base.html" %}

{% block title %}{% if site %}{{ _('Edit Site') }}{% else %}{{ _('New Site') }}{% endif %} - CommerceFlow{% endblock %}

{% block extra_css %}
<!-- Select2 CSS -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
<style>
    .select2-container {
        width: 100% !important;
    }
    .select2-container--default .select2-selection--single {
        height: 38px;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
    }
    .select2-container--default .select2-selection--single .select2-selection__rendered {
        line-height: 36px;
        padding-left: 12px;
    }
    .select2-container--default .select2-selection--single .select2-selection__arrow {
        height: 36px;
    }
</style>
{% endblock %}

{% block page_title %}{% if site %}{{ _('Edit Site') }}{% else %}{{ _('New Site') }}{% endif %}{% endblock %}
{% block page_subtitle %}{% if site %}{{ _('Modify site information') }}{% else %}{{ _('Add a new warehouse site') }}{% endif %}{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <form id="site-form" method="POST" action="{% if site %}{{ url_for('stock.update_site', site_id=site.id) }}{% else %}{{ url_for('stock.create_site') }}{% endif %}">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column - Main Info -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Basic Information -->
                <div style="background: var(--color-bg-secondary); border: 1px solid var(--color-border-default); border-radius: var(--radius-xl); padding: var(--spacing-lg); box-shadow: var(--shadow-md);">
                    <h3 class="text-lg font-bold mb-4" style="color: var(--color-text-primary);">{{ _('Site Information') }}</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: var(--color-text-secondary);">
                                {{ _('Site Code') }} <span style="color: var(--color-error);">*</span>
                            </label>
                            <input type="text" 
                                id="code"
                                name="code"
                                value="{% if site %}{{ site.code }}{% endif %}"
                                required
                                maxlength="50"
                                class="modern-input"
                                placeholder="SITE-001"
                                {% if site %}readonly{% endif %}>
                            {% if site %}
                            <p class="mt-1 text-xs text-gray-500">{{ _('Code cannot be changed after creation') }}</p>
                            {% endif %}
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: var(--color-text-secondary);">
                                {{ _('Site Name') }} <span style="color: var(--color-error);">*</span>
                            </label>
                            <input type="text" 
                                id="name"
                                name="name"
                                value="{% if site %}{{ site.name }}{% endif %}"
                                required
                                class="modern-input"
                                placeholder="{{ _('Site name') }}">
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: var(--color-text-secondary);">
                                {{ _('Address') }}
                            </label>
                            <textarea 
                                id="address"
                                name="address"
                                rows="3"
                                class="modern-input"
                                placeholder="{{ _('Site address') }}">{% if site %}{{ site.address or '' }}{% endif %}</textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Organization -->
            <div class="space-y-6">
                <!-- Organization -->
                <div style="background: var(--color-bg-secondary); border: 1px solid var(--color-border-default); border-radius: var(--radius-xl); padding: var(--spacing-lg); box-shadow: var(--shadow-md);">
                    <h3 class="text-lg font-bold mb-4" style="color: var(--color-text-primary);">{{ _('Organization') }}</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: var(--color-text-secondary);">
                                {{ _('Manager') }}
                            </label>
                            <select id="manager_id" name="manager_id" class="modern-input">
                                <option value="">{{ _('No manager') }}</option>
                                {% for user in users %}
                                <option value="{{ user.id }}" {% if site and site.manager_id == user.id %}selected{% endif %}>
                                    {{ user.username }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: var(--color-text-secondary);">
                                {{ _('Status') }}
                            </label>
                            <select id="status" name="status" class="modern-input">
                                <option value="active" {% if not site or site.status == 'active' %}selected{% endif %}>{{ _('Active') }}</option>
                                <option value="inactive" {% if site and site.status == 'inactive' %}selected{% endif %}>{{ _('Inactive') }}</option>
                                <option value="archived" {% if site and site.status == 'archived' %}selected{% endif %}>{{ _('Archived') }}</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex flex-col space-y-3">
                    <button type="submit" class="btn-primary w-full">
                        <i class="fas fa-save {% if direction == 'rtl' %}ml-2{% else %}mr-2{% endif %}"></i>
                        {{ _('Save') }}
                    </button>
                    <a href="{% if site %}{{ url_for('stock.view_site', site_id=site.id) }}{% else %}{{ url_for('stock.list_sites') }}{% endif %}" class="btn-secondary w-full text-center">
                        <i class="fas fa-times {% if direction == 'rtl' %}ml-2{% else %}mr-2{% endif %}"></i>
                        {{ _('Cancel') }}
                    </a>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<!-- jQuery and Select2 JS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
$(document).ready(function() {
    // Initialize Select2
    if (typeof jQuery !== 'undefined' && typeof jQuery.fn.select2 !== 'undefined') {
        $('#manager_id').select2({
            theme: 'bootstrap-5',
            placeholder: '{{ _("No manager") }}',
            allowClear: true,
            width: '100%'
        });
        
        $('#status').select2({
            theme: 'bootstrap-5',
            allowClear: false,
            width: '100%',
            minimumResultsForSearch: Infinity
        });
    }
});
</script>
{% endblock %}

